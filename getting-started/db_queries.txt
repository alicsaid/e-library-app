CREATE TABLE books (
    book_id SERIAL PRIMARY KEY, -- Automatski generisani ID za knjige
    title VARCHAR(255) NOT NULL, -- Naslov knjige
    author VARCHAR(255) NOT NULL, -- Autor knjige
    description TEXT, -- Opis knjige
    quantity INT NOT NULL DEFAULT 0, -- Količina dostupnih primjeraka
    isbn VARCHAR(13) UNIQUE NOT NULL, -- ISBN broj (13 znakova, jedinstven)
    published_date DATE, -- Datum objavljivanja
    genre VARCHAR(100), -- Žanr knjige
    publisher VARCHAR(255), -- Izdavačka kuća
    language VARCHAR(50), -- Jezik knjige
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- Datum i vreme kada je knjiga kreirana
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP -- Datum i vreme kada je knjiga poslednji put ažurirana
);

CREATE OR REPLACE FUNCTION update_timestamp()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_books_updated_at
BEFORE UPDATE ON books
FOR EACH ROW
EXECUTE FUNCTION update_timestamp();

INSERT INTO books (title, author, description, quantity, isbn, published_date, genre, publisher, language) VALUES
('The Great Gatsby', 'F. Scott Fitzgerald', 'A novel set in the 1920s about the American dream.', 10, '9780743273565', '1925-04-10', 'Fiction', 'Charles Scribner''s Sons', 'English'),
('To Kill a Mockingbird', 'Harper Lee', 'A novel about racial injustice in the Deep South.', 5, '9780061120084', '1960-07-11', 'Fiction', 'J.B. Lippincott & Co.', 'English'),
('1984', 'George Orwell', 'A dystopian novel about totalitarianism and surveillance.', 15, '9780451524935', '1949-06-08', 'Dystopian', 'Secker & Warburg', 'English'),
('Pride and Prejudice', 'Jane Austen', 'A romantic novel about the manners and matrimonial machinations.', 8, '9780141439518', '1813-01-28', 'Romance', 'T. Egerton', 'English'),
('Moby Dick', 'Herman Melville', 'The narrative of Captain Ahab''s obsessive quest for revenge.', 7, '9781503280786', '1851-10-18', 'Adventure', 'Richard Bentley', 'English'),
('War and Peace', 'Leo Tolstoy', 'A historical novel that chronicles the French invasion of Russia.', 3, '9781420954306', '1869-01-01', 'Historical Fiction', 'The Russian Messenger', 'Russian'),
('The Catcher in the Rye', 'J.D. Salinger', 'A story about teenage angst and alienation.', 12, '9780316769488', '1951-07-16', 'Fiction', 'Little, Brown and Company', 'English'),
('The Hobbit', 'J.R.R. Tolkien', 'A fantasy novel about the adventures of Bilbo Baggins.', 9, '9780547928227', '1937-09-21', 'Fantasy', 'George Allen & Unwin', 'English'),
('Fahrenheit 451', 'Ray Bradbury', 'A dystopian novel about a future where books are banned.', 6, '9781451673319', '1953-10-19', 'Dystopian', 'Ballantine Books', 'English'),
('The Alchemist', 'Paulo Coelho', 'A philosophical story about following your dreams.', 20, '9780062315007', '1988-05-01', 'Adventure', 'HarperOne', 'Portuguese'),
('The Picture of Dorian Gray', 'Oscar Wilde', 'A novel about a young man whose portrait ages while he remains young.', 4, '9781505291198', '1890-07-01', 'Gothic Fiction', 'Lippincott''s Monthly Magazine', 'English'),
('Brave New World', 'Aldous Huxley', 'A novel about a dystopian future where society is engineered.', 11, '9780060850524', '1932-08-31', 'Dystopian', 'Chatto & Windus', 'English'),
('Crime and Punishment', 'Fyodor Dostoevsky', 'A psychological drama about morality and redemption.', 2, '9780486415871', '1866-01-01', 'Psychological Fiction', 'The Russian Messenger', 'Russian'),
('The Grapes of Wrath', 'John Steinbeck', 'A novel about the hardships of the Great Depression.', 10, '9780143039433', '1939-04-14', 'Historical Fiction', 'The Viking Press', 'English'),
('The Lord of the Rings', 'J.R.R. Tolkien', 'An epic fantasy about the struggle between good and evil.', 5, '9780618640157', '1954-07-29', 'Fantasy', 'George Allen & Unwin', 'English');

CREATE TABLE rentals (
    rental_id SERIAL PRIMARY KEY,
    user_id INT NOT NULL,
    book_id INT NOT NULL,
    rental_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    return_date TIMESTAMP,
    status VARCHAR(50) DEFAULT 'active',
    due_date TIMESTAMP,
    archived BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (user_id) REFERENCES users(user_id),
    FOREIGN KEY (book_id) REFERENCES books(book_id)
);

CREATE TABLE users (
    user_id SERIAL PRIMARY KEY, -- Automatski generisani ID za korisnike
    first_name VARCHAR(100) NOT NULL, -- Ime korisnika
    last_name VARCHAR(100) NOT NULL, -- Prezime korisnika
    email VARCHAR(255) UNIQUE NOT NULL, -- Jedinstvena email adresa
    password VARCHAR(255), -- Lozinka korisnika (može biti NULL)
    role VARCHAR(20) NOT NULL CHECK (role IN ('librarian', 'member')), -- Uloga korisnika
    status BOOLEAN DEFAULT TRUE, -- Status korisnika: TRUE (aktivan) ili FALSE (neaktivan)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- Datum i vreme kada je korisnik kreiran
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP -- Datum i vreme kada je korisnik poslednji put ažuriran
);

CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_users_updated_at
BEFORE UPDATE ON users
FOR EACH ROW
EXECUTE FUNCTION update_updated_at_column();

INSERT INTO users (first_name, last_name, email, password, role, status) VALUES
('John', 'Doe', 'john.doe@library.com', 'password1', 'librarian', TRUE),
('Jane', 'Smith', 'jane.smith@library.com', 'password2', 'librarian', TRUE),
('Emily', 'Clark', 'emily.clark@library.com', 'password3', 'librarian', TRUE),
('Michael', 'Johnson', 'michael.johnson@library.com', NULL, 'member', TRUE),
('Sarah', 'Williams', 'sarah.williams@library.com', NULL, 'member', TRUE),
('David', 'Brown', 'david.brown@library.com', NULL, 'member', TRUE),
('Jessica', 'Jones', 'jessica.jones@library.com', NULL, 'member', TRUE),
('Daniel', 'Garcia', 'daniel.garcia@library.com', NULL, 'member', TRUE),
('Laura', 'Martinez', 'laura.martinez@library.com', NULL, 'member', TRUE),
('James', 'Rodriguez', 'james.rodriguez@library.com', NULL, 'member', TRUE),
('Sophia', 'Lee', 'sophia.lee@library.com', NULL, 'member', TRUE),
('Oliver', 'Hernandez', 'oliver.hernandez@library.com', NULL, 'member', TRUE),
('Mia', 'Lopez', 'mia.lopez@library.com', NULL, 'member', TRUE),
('Benjamin', 'Gonzalez', 'benjamin.gonzalez@library.com', NULL, 'member', TRUE),
('Isabella', 'Wilson', 'isabella.wilson@library.com', NULL, 'member', TRUE);

INSERT INTO rentals (user_id, book_id, rental_date, return_date, archived) VALUES
(1, 1, '2024-10-01', '2024-10-15', FALSE),
(2, 2, '2024-10-03', '2024-10-17', FALSE),
(3, 3, '2024-10-05', '2024-10-19', FALSE),
(4, 4, '2024-10-07', '2024-10-21', FALSE),
(5, 5, '2024-10-09', '2024-10-23', FALSE),
(1, 6, '2024-10-11', '2024-10-25', FALSE),
(2, 7, '2024-10-13', '2024-10-27', FALSE),
(3, 8, '2024-10-15', '2024-10-29', FALSE),
(4, 9, '2024-10-17', '2024-10-31', FALSE),
(5, 10, '2024-10-19', '2024-11-02', FALSE),
(6, 11, '2024-10-21', '2024-11-05', FALSE);



